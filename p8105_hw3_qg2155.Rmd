---
title: "p8105_hw3_qg2155"
author: "Qiu Xia (Helen) Guan"
date: "10/11/2018"
output: github_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages}
library(tidyverse)
library(patchwork)
library(p8105.datasets)
```

```{r page setup}
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = 1.3,
  out.width = "90%"
)

theme_set(theme_bw() + theme(legend.position = "bottom"))
```

## Problem 1

### Load and clean BRFSS dataset 
```{r get brfss}
data("brfss_smart2010")
```

```{r clean brfss}
brfss_data = brfss_smart2010 %>% 
  janitor::clean_names() %>% 
  filter(topic == "Overall Health") %>% 
  mutate(response = factor(response))
```

### Summarizing distinct locations 
```{r states}
brfss_data %>% 
  filter(year == 2002) %>% 
  group_by(locationabbr) %>%
  summarize(n_locations = n_distinct(locationdesc))
```
In 2002, there were 3 states that were observed at 7 locations. These 3 states were CT, FL, and NC. 

### Creating spaghetti plot of number locations 
```{r spaghetti plot}
brfss_data %>% 
  group_by(locationabbr, year) %>%
  summarize(n_locations = n_distinct(locationdesc)) %>% 
  ggplot(aes(x = year, y = n_locations, color = locationabbr)) + 
    geom_point() + geom_line()
```

### Table for mean and standard deviation of "Excellent" responses in NY
```{r  excellent responses}
brfss_data %>%
  group_by(year) %>% 
  filter(year == 2002 | year == 2006 | year == 2010) %>% 
  spread(key = response, value = data_value) %>% 
  janitor::clean_names() %>% 
  filter(locationabbr == "NY") %>% 
  summarize(mean_excellent = mean(excellent, na.rm = TRUE),
            sd_excellent = sd(excellent, na.rm = TRUE)) %>% 
  knitr::kable(digits = 1)
```

### Plot for distribution of each response category across states

```{r eresponses, eval = FALSE}
brfss_excellent = brfss_data %>% 
  group_by(year, locationabbr) %>%
  filter(response == "Excellent") %>% 
  summarize(mean_excellent = mean(data_value, na.rm = TRUE)) %>% 
  ggplot(aes(x = year, y = mean_excellent)) +
    geom_violin(aes(fill = locationabbr), color = "blue", alpha = .5)

brfss_verygood = brfss_data %>% 
  group_by(year, locationabbr) %>%
  filter(response == "Very good") %>% 
  summarize(mean_verygood = mean(data_value, na.rm = TRUE)) %>% 
  ggplot(aes(x = year, y = mean_verygood)) +
    geom_violin(aes(fill = locationabbr), color = "blue", alpha = .5)

brfss_good = brfss_data %>% 
  group_by(year, locationabbr) %>%
  filter(response == "Good") %>% 
  summarize(mean_good = mean(data_value, na.rm = TRUE)) %>% 
  ggplot(aes(x = year, y = mean_good)) +
    geom_violin(aes(fill = locationabbr), color = "blue", alpha = .5)

brfss_fair = brfss_data %>% 
  group_by(year, locationabbr) %>%
  filter(response == "Fair") %>% 
  summarize(mean_fair= mean(data_value, na.rm = TRUE)) %>% 
  ggplot(aes(x = year, y = mean_fair)) +
    geom_violin(aes(fill = locationabbr), color = "blue", alpha = .5)

brfss_poor = brfss_data %>% 
  group_by(year, locationabbr) %>%
  filter(response == "Poor") %>% 
  summarize(mean_poor = mean(data_value, na.rm = TRUE)) %>% 
  ggplot(aes(x = year, y = mean_poor)) +
    geom_violin(aes(fill = locationabbr), color = "blue", alpha = .5)

brfss_excellent/brfss_verygood/brfss_good/brfss_fair/brfss_poor